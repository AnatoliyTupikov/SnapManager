<Window x:Class="SnapManager.Views.WPF.CredentialsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SnapManager.Views.WPF"
        xmlns:helpers="clr-namespace:SnapManager.Views.WPF.WPFHelpers"
        xmlns:hierarchy="clr-namespace:SnapManager.Models.Hierarchy"
        xmlns:models="clr-namespace:SnapManager.Models"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        mc:Ignorable="d"
        MinHeight="400" MinWidth="500" Title="Credentials Manager" Height="400" Width="500" WindowStyle="ToolWindow">
    
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding WindowLoaded}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="7" />
            <ColumnDefinition Width="1.5*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <GridSplitter 
            Grid.Column="1"
            HorizontalAlignment="Stretch" Panel.ZIndex="3" Margin="0,0,0,5" Opacity="0"/>
        <Grid Grid.Column = "0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <StatusBar Grid.Row="0" Height="30" Background="White" BorderThickness="0" BorderBrush="#FFACACAC" Margin="5,0,0,0" >
                <StackPanel Orientation="Horizontal">
                    <Menu Background="Transparent">
                        <MenuItem Header="Add" BorderThickness="0" Background="Transparent" HorizontalContentAlignment="Left" VerticalContentAlignment="Center" Padding="5,0,5,0" Margin="0,2,0,0" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center" >
                            <MenuItem Header="Folder" Command="{Binding AddFolderCommand}" CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=TreeView}}"/>
                            <MenuItem Header="Credential" Command="{Binding AddCredentialCommand}" CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=TreeView}}"/>
                        </MenuItem>
                    </Menu>
                    
                    <Label Content="|" FontSize="18" HorizontalContentAlignment="Center" Padding="5,0,5,4" Margin="0,-1,0,0" FontStyle="Italic" FontFamily="Yu Gothic Light" />
                    <Button Content="Remove" BorderThickness="0" Background="Transparent"  HorizontalAlignment="Center" VerticalAlignment="Center" Height="20" Width="50"/>
                </StackPanel>

            </StatusBar>
            <TreeView x:Name="qwe" 
                Grid.Row="1" 
                Margin="5,0,0,0" 
                BorderThickness="1" 
                Panel.ZIndex="0" 
                BorderBrush="Black" 
                ItemsSource="{Binding CredHierarchy, Mode=TwoWay}"                
                AllowDrop="False">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectedItemChanged">
                        <i:InvokeCommandAction Command="{Binding SelectedItemChanged}" CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=TreeView}}"/>
                    </i:EventTrigger>                    
                </i:Interaction.Triggers>
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <TextBlock Text="{Binding Name, Mode=OneTime}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontStyle" Value="Normal"/>
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                            <Setter Property="FontStyle" Value="Italic"/>
                                            <Setter Property="Foreground" Value="#FF616161"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
                <TreeView.Resources>
                    <Style TargetType="TreeViewItem">
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Padding" Value="5"/>
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>                        
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsEditing, Mode=TwoWay}" Value="True">
                                <Setter Property="FontStyle" Value="Italic"/>
                                <Setter Property="Foreground" Value="#FF616161"/>
                            </DataTrigger>
                        </Style.Triggers>
                        
                    </Style>
                </TreeView.Resources>                
            </TreeView>
        </Grid>
        <DockPanel LastChildFill="True" Grid.Column="2" IsEnabled="True">
            <StackPanel Orientation="Horizontal" Height="25" DockPanel.Dock="Right" Margin="0,3,10,0" Panel.ZIndex="10" HorizontalAlignment="Right" VerticalAlignment="Top">
                <Button Content="Undo" BorderThickness="0" Background="Transparent" Width="35" HorizontalAlignment="Center" VerticalAlignment="Center" Height="20" Command="{Binding UndoChanges}" CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=TreeView}}"/>
                <Label Content="|" FontSize="18" HorizontalContentAlignment="Center" Padding="5,0,5,4" Margin="0,-1,0,0" FontStyle="Italic" FontFamily="Yu Gothic Light" />
                <Button Content="Save" BorderThickness="0" Background="Transparent" Width="30" HorizontalAlignment="Center" VerticalAlignment="Center" Height="20" Command="{Binding SaveChanges}" CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=TreeView}}"/>
            </StackPanel>

            <ContentControl Content="{Binding SelectedItem}">
                <ContentControl.Resources>
                    <Style TargetType="TextBox">
                        <Setter Property="Background" Value="White"/>                        
                    </Style>
                    <DataTemplate DataType="{x:Type models:FolderWithCredentials}">
                        <TabControl  BorderThickness="1" Panel.ZIndex="7" BorderBrush="Black" Margin="0,0,-86,0" ItemsSource="{Binding SelectedItem, Mode=TwoWay}">
                            <TabItem x:Name="General" Header="General" Height="28">
                                <Grid Background="#FFEFEFEF">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" MaxWidth="400" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="70"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Grid.Row="0" VerticalAlignment="Bottom" Margin="0,0,0,10">
                                        <Label Content="Name:" FontSize="14" Margin="10,10,0,0"/>
                                        <TextBox Margin="10,0,10,0" Height="25" Padding="2,5,2,5" Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                            <i:Interaction.Triggers>
                                                <i:EventTrigger EventName="TextChanged">
                                                    <i:InvokeCommandAction Command="{Binding DataContext.TextChangedCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
                                                </i:EventTrigger>
                                            </i:Interaction.Triggers>
                                        </TextBox>
                                    </StackPanel>

                                    <Grid Background="#FFEFEFEF" Grid.Row="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        <Label Grid.Row ="0"  Content="Description:" FontSize="14" Margin="10,0,0,0"/>
                                        <TextBox Grid.Row ="1" Margin="10,0,10,10"  Padding="2,5,2,5" VerticalScrollBarVisibility="Auto" AcceptsReturn="True" Text="{Binding Path=Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                            <i:Interaction.Triggers>
                                                <i:EventTrigger EventName="TextChanged">
                                                    <i:InvokeCommandAction Command="{Binding DataContext.TextChangedCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
                                                </i:EventTrigger>
                                            </i:Interaction.Triggers>                                        
                                        </TextBox>
                                    </Grid>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type models:Credential}">
                        <TabControl  BorderThickness="1" Panel.ZIndex="7" BorderBrush="Black" Margin="0,0,-86,0" ItemsSource="{Binding SelectedItem, Mode=TwoWay}">
                            <TabItem x:Name="General" Header="General" Height="28">
                                <Grid Background="#FFEFEFEF">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" MaxWidth="400" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="70"/>
                                        <RowDefinition Height="150"/>
                                        <RowDefinition Height="70"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Grid.Row="0" VerticalAlignment="Bottom" Margin="0,0,0,10">
                                        <Label Content="Name:" FontSize="14" Margin="10,10,0,0"/>
                                        <TextBox Margin="10,0,10,0" Height="25" Padding="2,5,2,5" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                            <i:Interaction.Triggers>
                                                <i:EventTrigger EventName="TextChanged">
                                                    <i:InvokeCommandAction Command="{Binding DataContext.TextChangedCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
                                                </i:EventTrigger>
                                            </i:Interaction.Triggers>
                                        </TextBox>
                                    </StackPanel>
                                    <Border Grid.Row="1" BorderThickness="1,1,1,1" BorderBrush="#FFDCD9D9" Margin="35,0,35,0" VerticalAlignment="Top">
                                        <StackPanel Grid.Row="1" Margin="0,0,0,15">
                                            <Label Content="Username:" FontSize="14" Margin="10,10,0,0"/>
                                            <TextBox Margin="10,0,10,0" Height="25" Padding="2,5,2,5" Text="{Binding Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                <i:Interaction.Triggers>
                                                    <i:EventTrigger EventName="TextChanged">
                                                        <i:InvokeCommandAction Command="{Binding DataContext.TextChangedCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
                                                    </i:EventTrigger>
                                                </i:Interaction.Triggers>
                                            </TextBox>
                                            <Label Content="Password:" FontSize="14" Margin="10,10,0,0" />
                                            <TextBox Margin="10,0,10,0" Height="25"  Padding="2,5,2,5" Text="{Binding Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                <i:Interaction.Triggers>
                                                    <i:EventTrigger EventName="TextChanged">
                                                        <i:InvokeCommandAction Command="{Binding DataContext.TextChangedCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
                                                    </i:EventTrigger>
                                                </i:Interaction.Triggers>                                            
                                            </TextBox>
                                        </StackPanel>
                                    </Border>
                                    <StackPanel Grid.Row="2" Orientation="Vertical" HorizontalAlignment="Right" Margin="0,0,10,0" VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" >
                                            <Label Content="Creation date:"/>
                                            <Label Content="{Binding CreationDateLocal, TargetNullValue='-'}" FontStyle="Italic" FontWeight="Bold" Foreground="#FF616161"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Label Content="Editing date:" />
                                            <Label Content="{Binding ModificationDateLocal, TargetNullValue='-'}" FontStyle="Italic" FontWeight="Bold" HorizontalAlignment="Right" Foreground="#FF616161"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                            <TabItem x:Name="Description" Header="Description">
                                <Grid Background="#FFEFEFEF">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Label Grid.Row ="0"  Content="Description" FontSize="14" Margin="10,10,0,0"/>
                                    <TextBox Grid.Row ="1" Margin="10,10,10,10"  Padding="2,5,2,5" VerticalScrollBarVisibility="Auto" AcceptsReturn="True" Text="{Binding Description, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="TextChanged">
                                                <i:InvokeCommandAction Command="{Binding DataContext.TextChangedCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </DataTemplate>
                    
                </ContentControl.Resources>
            </ContentControl>
            

        </DockPanel>
        <StatusBar Grid.Row="1" Grid.ColumnSpan="3" HorizontalContentAlignment="Right" VerticalContentAlignment="Stretch" FlowDirection="RightToLeft" Background="Transparent">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <Button Content="Apply" BorderThickness="1" Background="Transparent" Margin="2,0,0,0" Height="38" Width="86"/>
            </StackPanel>
        </StatusBar>

        







    </Grid>
</Window>
